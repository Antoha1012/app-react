{"ast":null,"code":"import _regeneratorRuntime from\"/Users/eugenechernomor/Downloads/optimizationProject-main/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/eugenechernomor/Downloads/optimizationProject-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/eugenechernomor/Downloads/optimizationProject-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/eugenechernomor/Downloads/optimizationProject-main/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{getAllPosts}from\"../../store/actionCreators/Posts\";import{getMorePosts}from\"./../../helpers/getMorePosts\";import{useObserver}from\"./../../hooks/useObserver\";import Preloader from\"../Preloader/Preloader\";import PostsFilter from\"../PostsFilter/PostsFilter\";import RandomNumber from\"../RandomNumber/RandomNumber\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PostsList=function PostsList(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),visiblePosts=_useState2[0],setVisiblePosts=_useState2[1];var lastElement=useRef();var _useSelector=useSelector(function(state){return state.posts;}),postsList=_useSelector.postsList,isFetching=_useSelector.isFetching;var dispatch=useDispatch();var observerCallback=function observerCallback(visiblePosts){var uploadedPosts=getMorePosts(postsList,visiblePosts);if(uploadedPosts){setVisiblePosts(function(visiblePosts){return[].concat(_toConsumableArray(visiblePosts),_toConsumableArray(uploadedPosts));});}};useEffect(function(){setVisiblePosts(function(visiblePosts){return _toConsumableArray(postsList.slice(0,visiblePosts.length));});},[postsList]);useObserver(lastElement,postsList.length!==visiblePosts,isFetching,observerCallback,visiblePosts);useEffect(function(){if(postsList.length!==0)return;var getPosts=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return dispatch(getAllPosts());case 2:case\"end\":return _context.stop();}}},_callee);}));return function getPosts(){return _ref.apply(this,arguments);};}();getPosts();},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(RandomNumber,{}),isFetching?/*#__PURE__*/_jsx(Preloader,{}):/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(PostsFilter,{posts:visiblePosts,lastElement:lastElement})}),/*#__PURE__*/_jsx(\"div\",{ref:lastElement,style:{height:\"10px\",backgroundColor:\"red\"}})]});};export default PostsList;","map":{"version":3,"sources":["/Users/eugenechernomor/Downloads/optimizationProject-main/src/components/PostsList/PostsList.js"],"names":["React","useEffect","useState","useRef","useSelector","useDispatch","getAllPosts","getMorePosts","useObserver","Preloader","PostsFilter","RandomNumber","PostsList","visiblePosts","setVisiblePosts","lastElement","state","posts","postsList","isFetching","dispatch","observerCallback","uploadedPosts","slice","length","getPosts","height","backgroundColor"],"mappings":"qjBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,MAArC,KAAmD,OAAnD,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CACA,OAASC,WAAT,KAA4B,kCAA5B,CACA,OAASC,YAAT,KAA6B,8BAA7B,CACA,OAASC,WAAT,KAA4B,2BAA5B,CACA,MAAOC,CAAAA,SAAP,KAAsB,wBAAtB,CACA,MAAOC,CAAAA,WAAP,KAAwB,4BAAxB,CACA,MAAOC,CAAAA,YAAP,KAAyB,8BAAzB,C,6IAEA,GAAMC,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACtB,cAAwCV,QAAQ,CAAC,EAAD,CAAhD,wCAAOW,YAAP,eAAqBC,eAArB,eACA,GAAMC,CAAAA,WAAW,CAAGZ,MAAM,EAA1B,CAEA,iBAAkCC,WAAW,CAAC,SAACY,KAAD,QAAWA,CAAAA,KAAK,CAACC,KAAjB,EAAD,CAA7C,CAAQC,SAAR,cAAQA,SAAR,CAAmBC,UAAnB,cAAmBA,UAAnB,CACA,GAAMC,CAAAA,QAAQ,CAAGf,WAAW,EAA5B,CAEA,GAAMgB,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACR,YAAD,CAAkB,CACzC,GAAMS,CAAAA,aAAa,CAAGf,YAAY,CAACW,SAAD,CAAYL,YAAZ,CAAlC,CACA,GAAIS,aAAJ,CAAmB,CACjBR,eAAe,CAAC,SAACD,YAAD,qCAAsBA,YAAtB,qBAAuCS,aAAvC,IAAD,CAAf,CACD,CACF,CALD,CAOArB,SAAS,CAAC,UAAM,CACda,eAAe,CAAC,SAACD,YAAD,4BACXK,SAAS,CAACK,KAAV,CAAgB,CAAhB,CAAmBV,YAAY,CAACW,MAAhC,CADW,GAAD,CAAf,CAGD,CAJQ,CAIN,CAACN,SAAD,CAJM,CAAT,CAMAV,WAAW,CACTO,WADS,CAETG,SAAS,CAACM,MAAV,GAAqBX,YAFZ,CAGTM,UAHS,CAITE,gBAJS,CAKTR,YALS,CAAX,CAQAZ,SAAS,CAAC,UAAM,CACd,GAAIiB,SAAS,CAACM,MAAV,GAAqB,CAAzB,CAA4B,OAE5B,GAAMC,CAAAA,QAAQ,0FAAG,yJACTL,CAAAA,QAAQ,CAACd,WAAW,EAAZ,CADC,uDAAH,kBAARmB,CAAAA,QAAQ,0CAAd,CAIAA,QAAQ,GACT,CARQ,CAQN,EARM,CAAT,CAUA,mBACE,wCACE,KAAC,YAAD,IADF,CAEGN,UAAU,cACT,KAAC,SAAD,IADS,cAGT,kCACE,KAAC,WAAD,EAAa,KAAK,CAAEN,YAApB,CAAkC,WAAW,CAAEE,WAA/C,EADF,EALJ,cASE,YACE,GAAG,CAAEA,WADP,CAEE,KAAK,CAAE,CAAEW,MAAM,CAAE,MAAV,CAAkBC,eAAe,CAAE,KAAnC,CAFT,EATF,GADF,CAgBD,CAtDD,CAwDA,cAAef,CAAAA,SAAf","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { getAllPosts } from \"../../store/actionCreators/Posts\";\nimport { getMorePosts } from \"./../../helpers/getMorePosts\";\nimport { useObserver } from \"./../../hooks/useObserver\";\nimport Preloader from \"../Preloader/Preloader\";\nimport PostsFilter from \"../PostsFilter/PostsFilter\";\nimport RandomNumber from \"../RandomNumber/RandomNumber\";\n\nconst PostsList = () => {\n  const [visiblePosts, setVisiblePosts] = useState([]);\n  const lastElement = useRef();\n\n  const { postsList, isFetching } = useSelector((state) => state.posts);\n  const dispatch = useDispatch();\n\n  const observerCallback = (visiblePosts) => {\n    const uploadedPosts = getMorePosts(postsList, visiblePosts);\n    if (uploadedPosts) {\n      setVisiblePosts((visiblePosts) => [...visiblePosts, ...uploadedPosts]);\n    }\n  };\n\n  useEffect(() => {\n    setVisiblePosts((visiblePosts) => [\n      ...postsList.slice(0, visiblePosts.length),\n    ]);\n  }, [postsList]);\n\n  useObserver(\n    lastElement,\n    postsList.length !== visiblePosts,\n    isFetching,\n    observerCallback,\n    visiblePosts\n  );\n\n  useEffect(() => {\n    if (postsList.length !== 0) return;\n\n    const getPosts = async () => {\n      await dispatch(getAllPosts());\n    };\n\n    getPosts();\n  }, []);\n\n  return (\n    <>\n      <RandomNumber />\n      {isFetching ? (\n        <Preloader />\n      ) : (\n        <div>\n          <PostsFilter posts={visiblePosts} lastElement={lastElement} />\n        </div>\n      )}\n      <div\n        ref={lastElement}\n        style={{ height: \"10px\", backgroundColor: \"red\" }}\n      ></div>\n    </>\n  );\n};\n\nexport default PostsList;\n"]},"metadata":{},"sourceType":"module"}